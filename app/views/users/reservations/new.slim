.row
  .big-label.yellow New reservation
.col-xs-12
  .row
    .col-xs-offset-1.col-xs-10.col-lg-offset-2.col-lg-8
      = simple_form_for [@user, @reservation], url: user_search_tables_path, html:{id:'reservation-form'}  do |f|
        = f.error_notification
        .choosing-box
          .row
            .col-lg-4.no-padding
              .text.long.day-toggle data-day="today" Today
            .col-lg-4.no-padding
              .text.long.day-toggle.selected data-day="tomorrow" Tomorrow
            .col-lg-4.no-padding
              .text.long.last.day-toggle data-day="date" Other Day
        .date
          = f.input :date, :as => :date_picker, html5: true
        = f.input :price, :collection => Preference::MENU_RANGE.map{|s| [s.capitalize, s]}, :include_blank => false, :selected => (@user.menu_range.nil? ? :lowcost : @user.menu_range )
        .text-center
          = f.input :after_plan, as: :boolean, label: false, :checked => (@user.after_plan.nil? ? true : @user.after_plan )
        = f.input :city, collection: City.all, :include_blank => false, :selected => (@user.city.nil? ? "" : @user.city.id )
        .friends-question
          label.control-label Friends
          h4
            input.company type="checkbox" Are you going with friends?
        .company-container hidden=true
          h4 How many?
          .choosing-box
            .text.toggle data-number=1 1
            .text.toggle data-number=2 2
          = f.simple_fields_for :companies do |company|
            = render 'company_fields', :f => company
        .text-center
          = f.button :submit, 'Search tables', class: 'button button-calm'
javascript:
  $(document).on('ready page:change', function() {
     var tomorrow = moment({ hour:21, minute:00 }).add(1, 'days');
     $('.datetimepicker').each(function(){
      $(this).data("DateTimePicker").date(tomorrow);
      $(this).data("DateTimePicker").minDate(tomorrow);
      $(this).data("DateTimePicker").maxDate(moment().add(30, 'days'));
     });

    $("#reservation_after_plan").bootstrapSwitch({
      'onText': 'Go for drinks',
      'offText': 'Go to sleep'
    });

    $(".company").change(function(){
      if($(this).is(":checked")){
        $(".company-container").show();
      }else{
        $(".company-container").hide();
      }

    });

    $(".friend-toggle").click(function () {

      $(this).siblings().removeClass("selected");
      $(this).addClass("selected");
      $($(this).parent().parent().parent().find(".gender")).val(($(this).data("gender")));
    });

    $(".day-toggle").click(function () {

      $(".day-toggle").removeClass("selected");
      $(this).addClass("selected");
      $("#reservation-form").attr("action", "#{user_search_tables_path}");
      $(".date").hide();

      switch($(this).data("day")){
        case "date": $(".date").show();
          $(".friends-question").show();
          break;
        case "today":
          $("#reservation-form").attr("action", "#{user_search_last_minute_diinners_path}");
          $(".friends-question").hide();
          var currentDate = new Date();
          var day = currentDate.getDate();
          var month = currentDate.getMonth() + 1;
          var year = currentDate.getFullYear();
          $("#reservation_date").val(day + "/" + month + "/" + year);
              break;
        case "tomorrow":
          $(".friends-question").show();
          var currentDate = new Date(new Date().getTime() + 24 * 60 * 60 * 1000);
          var day = currentDate.getDate();
          var month = currentDate.getMonth() + 1;
          var year = currentDate.getFullYear();
          $("#reservation_date").val(day + "/" + month + "/" + year);
              break;
      }
    });

    $(".toggle").click(function () {
      $(".friend").hide();

      $(".toggle").removeClass("selected");
      $(this).addClass("selected");
      if ($(this).data("number") == 1) {
        $($(".friend")[0]).show();
      } else {
        $(".friend").show();
      }
    })
  });