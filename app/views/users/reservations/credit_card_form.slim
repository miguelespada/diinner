.row
  .big-label.yellow Payment
.row
  .col-xs-12.col-md-8.col-md-offset-2
    .col-xs-12
      b Payment details
    .separator
    .col-xs-12
      b Restaurant:
      =< @reservation.restaurant.name
    .col-xs-12
      b Date:
      =< @reservation.date_and_time
    .col-xs-12
      b Price:
      =< "#{@reservation.price}â‚¬"
.row
  .separator
  - if @reservation.user.has_default_card?
    = form_tag user_reuse_card_path(@user, :reservation => @reservation.to_json), :method => :patch, :id => "reuse_card" do
      .col-xs-12.col-md-8.col-md-offset-2
        #submit-default-card.big-box.blue
          .text-center.card
            .bi.bi_ecommerce-creditcard-c
          .text Use saved card
          .text == cell(:user, @reservation.user).default_card
        = submit_tag "Use saved card", class: "hidden"
      .separator
      .col-xs-12.col-md-8.col-md-offset-2
        #other-card.big-box Use other card
  .col-xs-12.col-md-8.col-md-offset-2
    #other-card-form class=('hidden' if @reservation.user.has_default_card?)
      = javascript_include_tag "https://js.stripe.com/v2/"
      = tag :div, :id => "stripe-key", :data => {:content => ENV['STRIPE_PUBLISHABLE_KEY']}
      = javascript_include_tag "stripe.js"

      = form_tag user_new_card_path(@user, :reservation => @reservation.to_json), :method => :patch, :id => "new_reservation" do
        span.stripe-error
        = hidden_field_tag :stripe_card_token
        .form-group
          .col-xs-5
            label.control-label Card holder:
          .col-xs-7
            = text_field_tag :card_holder, nil, name: nil, class: "form-control"
        .form-group
          .col-xs-5
            label.control-label Card number:
          .col-xs-7
            = text_field_tag :card_number, nil, name: nil, size: 16, class: "form-control"
        .form-group
          .col-xs-5
            label.control-label CVC:
          .col-xs-7
            = text_field_tag :card_cvc, nil, name: nil, size: 3, class: "form-control"
        .form-group
          .col-xs-5
            label.control-label Expiration (MM/YYYY):
          .col-xs-3
            = text_field_tag :exp_month, nil, name: nil, size: 2, class: "form-control"
          .col-xs-4
            = text_field_tag :exp_year, nil, name: nil, size: 4, class: "form-control"
        .form-group
          .col-xs-2.text-right
            = check_box_tag :terms_and_conditions, class: "form-control"
          .col-xs-10
            = label_tag "I accept the terms and conditions"
        #submit-other-card.col-xs-12.text-center
          .button.button-calm Confirm
        .separator
        = submit_tag "Confirm", class: "hidden"

javascript:

  $("#submit-default-card").click(function(){
    $("#reuse_card").submit();
  });

  $("#submit-other-card").click(function () {
    console.log("clicking");
    $("#new_reservation").submit();
  });

  $("#other-card").click(function(){
    $("#other-card").hide();
    $("#other-card-form").removeClass("hidden");
  });


  $( "#new_reservation" ).submit(function( event ) {
     if(!$("#terms_and_conditions").is(":checked")){
      alert('You must accept terms of service.');
      return false;
    }
    else{
      return true
    }
  });

